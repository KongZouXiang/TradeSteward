var rememberCheckboxMap={};var flexgridpage=null;var flexgridrp=null;var timeouttips=false;var addDataFlag=null;function contains(a,b){return a&&a.indexOf(b)>=0;}function getValueFromRoot(c){var a;try{if($("#"+c).length>0){a=$("#"+c).val();}if(parent.$("#"+c).length>0){a=parent.$("#"+c).val();}if(parent.parent.$("#"+c).length>0){a=parent.parent.$("#"+c).val();}}catch(b){}return a;}function getUserId(){try{var b=getValueFromRoot("hidUserId");if(b&&b.length>0){return b;}}catch(a){}return"";}function isMoneyColum(b){if(contains(b,"(元)")){return true;}if(contains(b,"余额")){return true;}if(!b||contains(b,"账户")||contains(b,"价格权限")||contains(b,"支付方")){return false;}var a=!contains(b,"比重")&&!contains(b,"率")&&(contains(b,"额")||contains(b,"价")||contains(b,"款")||contains(b,"收入")||contains(b,"支出")||contains(b,"利")||contains(b,"惠")||contains(b,"费"));return a;}function isPercentage(b){var a=!contains(b,"获取频率")&&(contains(b,"比重")||contains(b,"率"));return a;}function isManyStore(){var a=getValueFromRoot("productversion");return"2"==(""+a);}function flexgridFormatMoney(a){if(!/^(-?\d+)(\.\d+)?$/.test(a)){return a;}var f=2;try{f=getValueFromRoot("PriceDecimalDigits");if(!f){f=2;}}catch(d){}try{if(f>4){f=4;}a=parseFloat(a);a=String(a.toFixed(f));var c=a.split(".");var b=/(-?\d+)(\d{3})/;while(b.test(c[0])){c[0]=c[0].replace(b,"$1,$2");}if(f<=0){a=c[0];}else{a=c[0]+"."+c[1];}}catch(d){}return a;}function createNoDataRow(a){var b=document.createElement("tr");$(b).html('<td id="tdNoData" align="center" style="background:#FFF;border:0;">	<div class="listNoData_parent">		<div class="tb_nodata">			当前列表无数据		</div>	</div></td>');$(a).append(b);$(".tb_nodata",a).show().delay(3000).fadeOut(200);}function createDetailRow(rownumber,p,row){var tr_detail=document.createElement("tr");$(tr_detail).attr("style","display:none;");tr_detail.id="row"+rownumber+"_detail";var td_detail=document.createElement("td");$(td_detail).attr("colspan","20");$(td_detail).attr("align","left");var table_detail_info=document.createElement("table");$(table_detail_info).attr("style","padding:0 0 15px 10px;margin: 0px 0px 10px 0px;");$(table_detail_info).attr("border","0");$(table_detail_info).attr("cellspacing","0");$(table_detail_info).attr("cellpadding","0");var isStopClass=false;if(row!=undefined&&row!=null&&row!=""){if(row.isstop!=undefined&&row.isstop!=null&&row.isstop!=""){if(row.isstop=="1"){isStopClass=true;}}}if(isStopClass){$(table_detail_info).attr("class","noborderTable ClientDisableDate");}else{$(table_detail_info).attr("class","noborderTable");}var tr_detail_info;var copyColModel=new Array();for(var i=0;i<p.colModel_Detail.length;i++){cm=p.colModel_Detail[i];copyColModel.push(p.colModel_Detail[i]);}tr_detail_info=document.createElement("tr");var tdtext=document.createElement("td");$(tdtext).attr("style","border-bottom:1px solid #d7d7d7");$(tdtext).attr("colspan","8");var contents="";var tdvalue="";for(var i=0;i<copyColModel.length;i++){if(copyColModel[i].isHeader==true){var cm=copyColModel[i];var content=row[cm.name];var dispaly=cm.display;if(isMoneyColum(dispaly)){content="￥"+flexgridFormatMoney(content);}if(copyColModel[i].isGeneral==true){if(copyColModel[i].name=="addsaleclient"){content='<span  style="line-height:35px;" class="font999"></span>';}else{if(copyColModel[i].name=="clientid"&&copyColModel[i].isStopBtn==true){content='<span  style="height:35px;float:right;margin-top:5px;" class="font999"><a class="button" onclick="stopClient(this)" >停用</a><input type="hidden" value="'+content+'" id="hidclientid" /></span>';}else{content='<span  style="line-height:35px;" class="font999">'+dispaly+":"+content+"</span>";}}if(cm.replaceHtmlFunction!=undefined){if(eval(cm.replaceHtmlFunction+"("+rownumber+");")!=""){var value=eval(cm.replaceHtmlFunction+"("+rownumber+");");if(value!="oneself"){tdvalue=value;}}}}else{content='<h2 class="fl" style="line-height:35px;">'+content+"</h2>";}contents+=content+"&nbsp;&nbsp;";}}$(tdtext).html(contents);$(tdtext).append(tdvalue);$(tr_detail_info).append(tdtext);$(table_detail_info).append(tr_detail_info);var curColCount=0;var tddetailvalue="";var salesmansyle="";for(var i=0;i<copyColModel.length;i++){cm=copyColModel[i];if(cm.isHeader!=true&&cm.isEnd!=true){if(curColCount%4==0){tr_detail_info=document.createElement("tr");$(table_detail_info).append(tr_detail_info);}curColCount++;td_detail_display=document.createElement("td");$(td_detail_display).attr("style","padding:15px 30px 0px 0;");var display=cm.display;var content=row[cm.name];if(cm.zero){if(content=="0"){content=cm.zero;}if(content=="1"){content=cm.one;}if(content=="2"){content=cm.two;}}if(content==undefined||content=="undefined"||(content+"").length==0){content=" - ";}else{if(content.length>10&&contains(cm.display,"日期")){content=content.substring(0,10);}else{if(content.length>19&&contains(cm.display,"时间")){content=content.substring(0,19);}else{if(isMoneyColum(cm.display)){content=flexgridFormatMoney(content);content="￥"+content;}else{if(isPercentage(cm.display)){content=content.toFixed(2);content=content+"%";}}}}}if(cm.isNoPerm){content="<span title='您没有权限访问该项'>-</span>";}if(cm.replaceHtmlFunction!=undefined){if(eval(cm.replaceHtmlFunction+"("+rownumber+");")!=""){var value=eval(cm.replaceHtmlFunction+"("+rownumber+");");if(value!="oneself"){tddetailvalue=value;if(tddetailvalue==undefined||tddetailvalue==null||tddetailvalue=="undefined"||(tddetailvalue+"").length==0){tddetailvalue=" - ";}if(tddetailvalue!=undefined&&tddetailvalue!=null&&tddetailvalue.indexOf("REPLACEGRAY_")>=0){tddetailvalue=tddetailvalue.replace("REPLACEGRAY_","");salesmansyle="REPLACEGRAY_";}content=tddetailvalue;}}}else{salesmansyle="";}if("undefined"!=typeof cm.isHide){var tdHide=false;if($.isFunction(cm.isHide)){tdHide=cm.isHide(rownumber);}else{tdHide=cm.isHide;}if(tdHide){$(td_detail_display).hide();}}$(td_detail_display).html(display+":");if(content.length>40){if(salesmansyle=="REPLACEGRAY_"){$(td_detail_display).html('<span class="font999">'+display+':</span><span class="ellipsis" style="color: #d1d1d6;" title="'+content+'">'+content.substring(0,19)+"...</span>");}else{$(td_detail_display).html('<span class="font999">'+display+':</span><span class="ellipsis" title="'+content+'">'+content.substring(0,19)+"...</span>");}}else{if(salesmansyle=="REPLACEGRAY_"){$(td_detail_display).html('<span class="font999">'+display+':</span><span style="color: #d1d1d6;">'+content+"</span>");}else{$(td_detail_display).html('<span class="font999">'+display+":</span>"+content);}}$(tr_detail_info).append(td_detail_display);}}var orderplus=false;tr_detail_info_empty=document.createElement("tr");var tdtext_empty=document.createElement("td");$(tdtext_empty).attr("style","height:10px;");$(tr_detail_info_empty).append(tdtext_empty);tr_detail_info_orderplus=document.createElement("tr");var tdtext_orderplus=document.createElement("td");$(tdtext_orderplus).attr("style","border-top:1px solid #d7d7d7;padding:0;");$(tdtext_orderplus).attr("colspan","8");var contents="";for(var i=0;i<copyColModel.length;i++){if(copyColModel[i].isEnd==true){var cm=copyColModel[i];var content=row[cm.name];var ext1=row.ext1;var dispaly=cm.display;orderplus=true;if(copyColModel[i].isGeneral==true){if(content!=null){content='<span  style="line-height:35px;" class="font999">'+dispaly+":"+content+"</span>";}else{if(dispaly=="已开通网店账号"){content='<span  style="line-height:35px;" class="font999">未开通网店账号</span>';}if(dispaly=="所属业务员"){content='<span  style="height:27px;float:right;margin-top:13px;" class="font999"><a class="" onclick="inviteClient()" style="width: 150px;"><i class="fl mr5 ClientIcon_01"></i>邀请开通网店账号</a></span>';}}}if("2"!=ext1){contents+=content+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";}}}$(tdtext_orderplus).html(contents);$(tr_detail_info_orderplus).append(tdtext_orderplus);if(orderplus){$(table_detail_info).append(tr_detail_info_empty);$(table_detail_info).append(tr_detail_info_orderplus);}$(tr_detail).append(td_detail);$(td_detail).append(table_detail_info);return tr_detail;}function addTrMouseOverOrOutEvent(b,a){$(b).mouseover(function(){if($(b).hasClass("yellowLine")){$(b).css("background","#f6f5bb");$(".t_left #"+a).css("background","#f6f5bb");$(".t_r #"+a).css("background","#f6f5bb");}else{$(b).css("background","#e4f3ff");$(".t_left #"+a).css("background","#e4f3ff");$(".t_r #"+a).css("background","#e4f3ff");}});$(b).mouseout(function(){$(b).css("background","");$(".t_left #"+a).css("background","");$(".t_r #"+a).css("background","");});}function asynGenRow(e,l,b,j,q){if(e.addDataFlag!=addDataFlag){return;}var a=$(j.hDiv).find("#theader th");var h=$(j.left_hDiv).find("#theader th");var r=e.rows[l];if(!b.colModel_Detail&&!b.noLeftSplit){var c=createGeneralRow(h,l,b,r);$(j.left_bTable).append(c);}var k=createGeneralRow(a,l,b,r);$(q).append(k);if(b.colModel_Detail||b.detialDivUniqueId){$(q).append(createDetailRow(l,b,r,b.detialDivUniqueId));}if(l<e.rows.length-1){l++;setTimeout(function(){asynGenRow(e,l,b,j,q);},0);}else{if(e.sumRow){$(q).append(createSumRow(a,b,e.sumRow));if(!b.colModel_Detail&&!b.noLeftSplit){$(j.left_bTable).append(createSumRow(h,b,e.sumRow));}}j.columnSort();if(typeof loadedSuccess==="function"){loadedSuccess();}var f=b.rp;var o=b.page;f=parseInt(f);o=parseInt(o);var m=true;for(var d=f*(o-1)+1;d<=f*(o-1)+f;d++){if(rememberCheckboxMap[d]!=undefined){$(q).find("#fcheckbox"+d).attr("checked",true);}else{m=false;}}if(m==false){$("#selectAllCheckbox",j.hDiv).attr("checked",false);}else{$("#selectAllCheckbox",j.hDiv).attr("checked",true);}}}function createGeneralRow(ths,transverseNumber,p,row){var tr=document.createElement("tr");var rowid="row"+transverseNumber;$(tr).attr("id",rowid);$(tr).attr("NormalRow",true);if(transverseNumber%2&&p.striped){tr.className="greyLine";}addTrMouseOverOrOutEvent(tr,rowid);for(var i=0;i<ths.length;i++){th=ths[i];var td=document.createElement("td");var thid=$(th).attr("id");$(td).attr("thid",thid);if($(ths).parent().find("#"+thid).css("display")=="none"){$(td).hide();}$(td).width(th.width);$(td).height(26);var idnumber=$(th).attr("number");var cm=p.colModel[idnumber];$(td).attr("thname",cm.name);td.align="center";if(cm.align){td.align=cm.align;}var tdvalue=row[cm.name];if(tdvalue==undefined||tdvalue=="undefined"||(tdvalue+"").length==0){tdvalue="";}else{if(cm.display){if(tdvalue.length>10&&contains(cm.display,"日期")){tdvalue=tdvalue.substring(0,10);}else{if(tdvalue.length>19&&contains(cm.display,"时间")){tdvalue=tdvalue.substring(0,19);}else{if(isMoneyColum(cm.display)){tdvalue=flexgridFormatMoney(tdvalue);}else{if(isPercentage(cm.display)){tdvalue=tdvalue.toFixed(2);tdvalue=tdvalue+"%";}}}}}}if(undefined!=cm.isRowspan&&true==cm.isRowspan){if(parseInt(row.rowspan)>1){$(td).attr("rowspan",parseInt(row.rowspan));}else{$(td).hide();}}td.innerHTML=tdvalue;if(cm.customLineStyles!=undefined&&$(tr).attr("setttedCustomLineStyles")==undefined){var trClass=eval(cm.customLineStyles+"("+transverseNumber+");");if(trClass!=""){$(tr).attr("class",trClass);$(tr).attr("setttedCustomLineStyles",true);}}if(cm.customElementsEvent!=undefined){var str1=cm.customElementsEvent;var str=cm.customElementsEventFunction+"("+transverseNumber+");";$(td).bind(str1,function(){eval(str);});}if(cm.customTitle!=undefined){var str=eval(cm.customTitle+"("+transverseNumber+");");if(str!=""){$(td).attr("title",str);}}var clickflag=true;if(cm.isButton==true){var div=document.createElement("div");$(div).attr("class","tableButtonArea");$(td).append(div);clickflag=false;if(p.buttons){for(var n=0;n<p.buttons.length;n++){var button=p.buttons[n];var a=document.createElement("a");$(a).attr("id",n);if(button.isHide!=undefined){var flag=eval(button.isHide+"("+transverseNumber+");");if(flag==false||flag==undefined){if(button.customHtml){$(div).append(button.customHtml);}else{if(button.customChange!=undefined){$(div).append(eval(button.customChange+"("+transverseNumber+");"));}else{if(button.isText==true){$(div).append(a);$(a).html(button.name);$(a).addClass(button.bclass);$(a).attr("title",button.name);$(a).attr("onclickevent",button.onpress+"("+transverseNumber+");");a.onclick=function(){eval($(this).attr("onclickevent"));};}else{$(div).append(a);$(a).addClass(button.bclass);$(a).attr("title",button.name);$(a).attr("onclickevent",button.onpress+"("+transverseNumber+");");a.onclick=function(){eval($(this).attr("onclickevent"));};}}}}}else{if(button.customHtml){$(div).append(button.customHtml);}else{if(button.customChange!=undefined){$(div).append(eval(button.customChange+"("+transverseNumber+");"));}else{if(button.isText==true){$(div).append(a);$(a).html(button.name);$(a).addClass(button.bclass);$(a).attr("title",button.name);$(a).attr("onclickevent",button.onpress+"("+transverseNumber+");");a.onclick=function(){eval($(this).attr("onclickevent"));};}else{$(div).append(a);$(a).addClass(button.bclass);$(a).attr("title",button.name);$(a).attr("onclickevent",button.onpress+"("+transverseNumber+");");a.onclick=function(){eval($(this).attr("onclickevent"));};}}}}}}}if(cm.isCheckbox==true){clickflag=false;var page=p.page;var count=(p.page-1)*(p.rp)+transverseNumber+1;var fcheckboxId="fcheckbox"+count;td.innerHTML="";var hasSameCheckbox=$("#FlexiGridRoot"+p.id).find("input[name='fcheckbox'][count='"+count+"']").length;if(hasSameCheckbox==0){td.innerHTML="<input count="+count+" page="+page+' onclick="rememberCheckbox(this)" id='+fcheckboxId+' name="fcheckbox" number="'+transverseNumber+'" listcheck="0" type="checkbox" value="'+row[p.colModel[idnumber].name]+'"/>';}}if(cm.isNo){td.innerHTML=(p.page-1)*p.rp+transverseNumber+1;}if(cm.replaceHtmlFunction!=undefined){if(eval(cm.replaceHtmlFunction+"("+transverseNumber+");")!=""){var value=eval(cm.replaceHtmlFunction+"("+transverseNumber+");");if(value!="oneself"){td.innerHTML=value;}}}if(cm.replaceImageFunction!=undefined){if(eval(cm.replaceImageFunction+"("+transverseNumber+");")!=""){td.innerHTML="<img src="+eval(cm.replaceImageFunction+"("+transverseNumber+");")+"></img>";}}if(cm.replaceTextFunction!=undefined){if(eval(cm.replaceTextFunction+"("+transverseNumber+");")!=""){td.innerHTML=eval(cm.replaceTextFunction+"("+transverseNumber+");")+"";}}if(cm.showDiv!=undefined){var src=eval(cm.showDiv+"("+transverseNumber+");");if(src!=null){var div1=document.createElement("div");$(div1).attr("class","helpinfo");$(div1).attr("style","background:none; position:absolute; margin:3px 0 0 -95px;display:none");var div2=document.createElement("div");$(div2).attr("class","tips");var h2=document.createElement("h2");$(h2).attr("style","margin-left:150px;");var h1=document.createElement("h1");$(h1).attr("style","width:250px; text-align:center;");$(h1).append(src);$(div2).append(h2);$(div2).append(h1);$(div1).append(div2);$(div1).hide();$(td).append(div1);$(src).hover(function(){$(div1).attr("style","background:none; position:absolute; margin:3px 0 0 -95px;display:none");},function(){$(div1).attr("style","background:none; position:absolute; margin:3px 0 0 -95px;display:none");});$(td).hover(function(){$(src).attr("style","");$(div1).attr("style","background:none; position:absolute; margin:3px 0 0 -95px;");},function(){$(div1).attr("style","background:none; position:absolute; margin:3px 0 0 -95px;display:none");});}}if(cm.zero!=undefined){var tdvalue=row[cm.name];if(tdvalue==2){td.innerHTML=cm.two;}if(tdvalue==1){td.innerHTML=cm.one;}if(tdvalue==0){td.innerHTML=cm.zero;}}if(cm.fixedValue!=undefined&&"true"!=cm.fixedValue){if(transverseNumber==0){td.innerHTML=cm.fixedValue;}}if(clickflag==true){$(td).click(function(){$(td).append();var tr_id=$(tr).attr("id");var detail_id="#"+tr_id+"_detail";if($(detail_id).length>0){if($(detail_id).css("display")=="none"){$(detail_id).css("display","");}else{$(detail_id).css("display","none");}}else{if(p.addTdClickSelectEvent){var page=p.page;var count=(p.page-1)*(p.rp)+transverseNumber+1;var fcheckboxId="fcheckbox"+count;var fcheckbox=$("#"+fcheckboxId);if(fcheckbox.length>0){if($(fcheckbox).attr("checked")){$(fcheckbox).removeAttr("checked").click().removeAttr("checked");}else{$(fcheckbox).attr("checked",true).click().attr("checked",true);}}}}});}if(td.innerHTML==""){td.innerHTML="&nbsp;";}if(cm.noDrag){}else{var tableTextDiv=document.createElement("div");var isProductunitname=false;if(cm.name!=undefined&&cm.name!=null&&cm.name!=""){if(cm.name=="productunitname"){isProductunitname=true;}}var isProductsName=false;if(cm.name!=undefined&&cm.name!=null&&cm.name!=""){if(cm.name=="products"){isProductsName=true;}}if(isProductunitname){$(tableTextDiv).attr("class","tableText tableTextOverF");}else{if(isProductsName){$(tableTextDiv).attr("class","tableText aui-ellipsis");if(topOrigin.layer.ie){$(tableTextDiv).attr("class","ellipsis");}}else{$(tableTextDiv).attr("class","tableText");}}$(tableTextDiv).css("width",$("#"+thid).attr("personwidth")+"px");var tdChildren=$(td).contents();if(tdChildren&&tdChildren.length>0){$(tableTextDiv).append(tdChildren);}else{$(tableTextDiv).append(td.innerHTML);}$(td).empty();$(td).append(tableTextDiv);}$(tr).append(td);}return tr;}function rememberCheckbox(g){var f=window.location.href;if(f.indexOf("nowarehouselock=nolocked")==-1){var d=$(parent.document).find("#productversion").val();if(d!=3){var a=$("#hiddetailwarehouseid").val();if(a!=undefined&&a!=""&&a!=null){if(getWareHouseIsLocked(1)){return;}}}}var e=$(g).val();var c=$(g).attr("count");if($(g).attr("checked")){rememberCheckboxMap[c]=e;$("[id='row"+$(g).attr("number")+"']").each(function(){$(this).addClass("yellowLine");});}else{delete rememberCheckboxMap[c];$("[id='row"+$(g).attr("number")+"']").each(function(){$(this).removeClass("yellowLine");});}var b=0;$("[name='fcheckbox']").each(function(){if($(this).attr("checked")){b++;}});}function createSumRow(ths,p,row){var tr=document.createElement("tr");var rowid="rowSum";$(tr).attr("id",rowid);$(tr).attr("SumRow",true);addTrMouseOverOrOutEvent(tr,"rowSum");for(var i=0;i<ths.length;i++){th=ths[i];var td=document.createElement("td");var thid=$(th).attr("id");$(td).attr("thid",thid);$(td).height(26);if($("#"+thid).is(":hidden")==true){$(td).hide();}var idnumber=$(th).attr("number");var cm=p.colModel[idnumber];$(td).attr("thname",cm.name);td.align="center";if(cm.align){td.align=cm.align;}var tdvalue="";if(idnumber==1){tdvalue="合计";}if(cm.isSum){tdvalue=row[cm.name];if(tdvalue==null||tdvalue=="null"||tdvalue==""){tdvalue="0";}if(cm.display){if(isMoneyColum(cm.display)){tdvalue="￥"+flexgridFormatMoney(tdvalue);tdvalue='<span class="font16 fontRed money">'+tdvalue+"</span>";}if(cm.fixedValue){tdvalue='<span class="font16 fontRed money">￥'+cm.fixedValue+"</span>";}if("true"==cm.fixedValue){if(cm.replaceHtmlFunction!=undefined){if(eval(cm.replaceHtmlFunction+"("+0+");")!=""){var value=eval(cm.replaceHtmlFunction+"("+0+");");if(value!="oneself"){tdvalue='<span class="font16 fontRed money">￥'+flexgridFormatMoney(value)+"</span>";}}}}}var costprice=$("#costprice",parent.document).val();if(costprice==""||costprice==undefined){costprice=$("#costprice",parent.parent.document).val();}if("0"==costprice&&undefined!=cm.display&&null!=cm.display&&(contains(cm.display,"毛利")||contains(cm.display,"库存总额")||contains(cm.display,"盘亏金额")||contains(cm.display,"盘盈金额"))){tdvalue="<span>-</span>";}var saleprice=$("#saleprice",parent.document).val();if(saleprice==""||saleprice==undefined){saleprice=$("#saleprice",parent.parent.document).val();}if("0"==saleprice&&undefined!=cm.display&&null!=cm.display&&contains(cm.display,"零售价总额")){tdvalue="<span>-</span>";}}if(cm.noDrag){}else{var tableTextDiv=document.createElement("div");$(tableTextDiv).attr("class","tableText");$(tableTextDiv).css("width",$("#"+thid).attr("personwidth")+"px");$(tableTextDiv).append(tdvalue);$(td).empty();$(td).append(tableTextDiv);}$(tr).append(td);}return tr;}function sleep(b){var a=new Date();var c=a.getTime()+b;while(true){a=new Date();if(a.getTime()>c){return;}}}var myRows=null;var sumRow=null;var n=0;function getSumRow(){return sumRow;}(function($){var myGrid=null;function doResize(){try{if(myGrid!=null&&myGrid.resizeTableWidth!=null){myGrid.resizeTableWidth();}}catch(e){}}function autoResize(){try{if(myGrid!=null&&myGrid.mustResizeTableWidth()){doResize();}}catch(e){}}setInterval(autoResize,200);$.addFlex=function(t,p){p=$.extend({id:null,pricePointNum:2,height:"auto",width:"auto",striped:true,minwidth:23,minheight:80,resizable:true,url:false,method:"POST",dataType:"json",errormsg:"连接失败",nowrap:false,page:1,total:1,useRp:true,rp:15,rpOptions:[10,15,20,30,50],pagestat:"显示 {from} 到 {to} 项数据，共 {total} 条数据",pagetext:"页",procmsg:"正在加载数据 ...",query:"",qtype:"",nomsg:"无相关数据",minColToggle:1,getGridClass:function(g){return g;},colResize:true,colMove:true,detailRowNumber:4,cellPadding:5,thCellPadding:5,trCellPadding:5,showOrHideTh:3,draging:false,addTdClickSelectEvent:true,isEnableShowOrHide:true},p);if("undefined"!=typeof p.colModel&&null!=typeof p.colModel){for(var i in p.colModel){var col=p.colModel[i];col=$.extend({isConfigurable:true,canSetShow:true,columnSortable:true,},col);if(contains(col.display,"操作")){col.isConfigurable=true;col.canSetShow=false;col.columnSortable=false;}if(col.isCheckbox||col.isNo||(col.isButton&&contains(col.display,"数量"))){col.isConfigurable=false;col.canSetShow=false;col.columnSortable=false;}col.isFixedColumn=!col.canSetShow&&!col.columnSortable;if(col.isFixedColumn){col.isLeft=true;}p.colModel[i]=col;}}else{p.colModel=[];}p.colModel.push({display:"FillEmptyColumn",name:"FillEmptyColumn",width:"0",isHide:true,isConfigurable:false,});if(p.id){p.FlexiGridRootId="FlexiGridRoot"+p.id;}else{p.FlexiGridRootId="FlexiGridRoot";}try{var userRp=window.localStorage.getItem("tableSet_rp"+p.id+getUserId());if(userRp&&userRp.length>1){p.rp=userRp;}p.sortOrderOrigin=p.sortorder;var userSortorder=window.localStorage.getItem("tableSet_sortorder"+p.id+getUserId());if(userSortorder&&userSortorder.length>1){p.sortorder=userSortorder;}p.sortNameOrigin=p.sortname;var userSortname=window.localStorage.getItem("tableSet_sortname"+p.id+getUserId());if(userSortname&&userSortname.length>1){p.sortname=userSortname;}}catch(e){}var colModelCopy=new Array();var buttonColom=false;var hasCheckBox=false;var customLineStyles;for(var k=0;k<p.colModel.length;k++){var ccm=p.colModel[k];if(!customLineStyles&&ccm.customLineStyles){customLineStyles=ccm.customLineStyles;}ccm.customLineStyles=customLineStyles;if(!p.colModel_Detail&&!p.noLeftSplit){if(ccm.isCheckbox||contains(ccm.display,"序号")||contains(ccm.display,"操作")){ccm.isLeft=true;}}if(ccm.isCheckbox){hasCheckBox=true;colModelCopy.push(ccm);}else{if(!isManyStore()&&contains(ccm.display,"门店")){}else{if(!ccm.isButton){colModelCopy.push(ccm);}else{buttonColom=ccm;}}}}if(buttonColom){if(hasCheckBox){colModelCopy.splice(2,0,buttonColom);}else{colModelCopy.splice(1,0,buttonColom);}}p.colModel=colModelCopy;if(p.colModel_Detail){var colModelDetailCopy=new Array();for(var k=0;k<p.colModel_Detail.length;k++){var ccm=p.colModel_Detail[k];if(!isManyStore()&&contains(ccm.display,"门店")){}else{colModelDetailCopy.push(ccm);}}p.colModel_Detail=colModelDetailCopy;}$(t).show().attr({cellPadding:0,cellSpacing:0}).removeAttr("width");var g={dragStart:function(dragtype,e,obj){p.draging=true;if(dragtype=="colresize"&&p.colResize===true){var n=$(obj).attr("index");this.colresize={startX:e.pageX,ol:parseInt(obj.style.left,10),nl:parseInt(obj.style.left,10),n:n};$("body").css("cursor","col-resize");}$("body").noSelect(true);},dragMove:function(e){if(this.colresize){var n=this.colresize.n;var diff=e.pageX-this.colresize.startX;var nleft=this.colresize.ol+diff;this.colresize.nl=nleft;var flexiGridRoot=$("#"+p.FlexiGridRootId);$("#dragLineDiv"+n,flexiGridRoot).css("left",nleft);}},dragEnd:function(){p.draging=false;if(this.colresize){var n=this.colresize.n;var flexiGridRoot=$("#"+p.FlexiGridRootId);var nw=parseInt($("#th"+n,flexiGridRoot).attr("personwidth"),10)+(this.colresize.nl-this.colresize.ol);if(nw<p.minwidth){nw=p.minwidth;}$("th[id='th"+n+"']",flexiGridRoot).attr("personwidth",nw);this.colresize=false;this.resizingTdWidth(g.bDiv,g.hDiv);this.resizingTdWidth(g.left_bDiv,g.left_hDiv);this.setDragSettings();}doResize();$("body").css("cursor","default");$("body").noSelect(false);},resizingTdWidth:function(bDiv,hDiv){$("tr:first th",hDiv).each(function(){var th=this;var width=$(th).attr("personwidth");width=parseInt(width);$(th).attr("width",width);$(th).find(".bg").each(function(){$(this).css("width",width+"px");});$("#dragLineDiv"+$(th).attr("number"),hDiv).css({left:(width+9)+"px",top:"0px"});});$("tr",bDiv).each(function(n){if($(this).attr("NormalRow")||$(this).attr("SumRow")){$("td",this).each(function(i){var thid=$(this).attr("thid");if(thid){var th=$(this).parents("table").find("#"+thid);if(th.length==0&&$(this).parents(".bDivLeft").length==1&&$(this).parents(".t_left").length==1){th=$(this).parents(".t_left").find("#"+thid);}var width=th.attr("personwidth");width=parseInt(width);$(this).css("width",width+"px");$(this).find(".tableText").each(function(){$(this).css("width",width+"px");});}});}});},showOrHideColum:function(value,ischeck,notResizeTableWidth){var content="";var thid="";$("#theader th",g.hDiv).each(function(){content=$(this).attr("display")+"";thid=$(this).attr("id");if(contains(content,value)){if(ischeck){$(this).show();}else{$(this).hide();}$("tbody tr",t).each(function(){var id=$(this).attr("id");if(id!=undefined&&id!=null&&id!=""&&id.indexOf("detail")==-1){if(ischeck){$('[thid="'+thid+'"]',this).show();}else{$('[thid="'+thid+'"]',this).hide();}}});}});this.resizingTdWidth(g.bDiv,g.hDiv);this.resizingTdWidth(g.left_bDiv,g.left_hDiv);if("undefined"!=notResizeTableWidth&&!notResizeTableWidth){this.resizeTableWidth();}},showOrHideAllColumn:function(){var customSettings=g.getCustomSettings();if(null!=customSettings&&""!=customSettings&&customSettings.length>0){colModelCopy=JSON.parse(JSON.stringify(p.colModel));var getSetCol=function(columnName){for(var each in customSettings){if(columnName==customSettings[each].columnName){return customSettings[each];}}};for(var each in colModelCopy){if(colModelCopy[each].isCheckbox||colModelCopy[each].isNo||colModelCopy[each].isButton){colModelCopy[each].isHide=false;continue;}var setCol=getSetCol(colModelCopy[each].name);if("undefined"!=typeof setCol&&setCol.isShow){colModelCopy[each].isHide=false;}else{colModelCopy[each].isHide=true;}}for(var i in colModelCopy){var set=colModelCopy[i];if(set.isHide){if($("th[display='"+set.display+"']",g.hDiv).is(":visible")){g.showOrHideColum(set.display,false,true);}}else{if(!$("th[display='"+set.display+"']",g.hDiv).is(":visible")){g.showOrHideColum(set.display,true,true);}}}}this.resizeTableWidth();},columnSort:function(){if(!p.isEnableShowOrHide){return;}var customSettings=g.getCustomSettings();if(null!=customSettings&&""!=customSettings&&customSettings.length>0){g.showOrHideAllColumn();var hasSetSortIndex=$(g.left_hDiv).find("table").find("th").length;if(null==hasSetSortIndex||0==hasSetSortIndex){for(var i in p.colModel){var col=p.colModel[i];if(col.isFixedColumn){hasSetSortIndex++;}}}for(var i in customSettings){var set=customSettings[i];if(set.isFixedColumn){continue;}var name=set.columnName;var headTh=$('#theader th[name="'+name+'"]',g.hDiv);if(!$("#theader th:eq("+hasSetSortIndex+")",g.hDiv).is(headTh)){$("#theader th:eq("+hasSetSortIndex+")",g.hDiv).before(headTh);}$("tbody tr",t).each(function(){var dataTd=$(this).find("td[thname='"+name+"']");if(!$(this).find("td:eq("+hasSetSortIndex+")").is(dataTd)){$(this).find("td:eq("+hasSetSortIndex+")").before(dataTd);}});hasSetSortIndex++;}}},delCustomSettings:function(){if(p.id==null){return;}window.localStorage.setItem("tableSet"+p.id+getUserId(),"");window.localStorage.setItem("tableDragSet"+p.id+getUserId(),"");window.localStorage.setItem("tableSet_sortorder"+p.id+getUserId(),"");window.localStorage.setItem("tableSet_sortname"+p.id+getUserId(),"");window.localStorage.setItem("tableSet_rp"+p.id+getUserId(),"");},getCustomSettings:function(){if(p.id==null){return null;}var customSettings=null;try{var customSettingsStr=window.localStorage.getItem("tableColumnSet_"+p.id+"_"+getUserId());if(customSettingsStr!=null&&customSettingsStr!=""){customSettings=eval(customSettingsStr);}else{var arr=[];for(var i in p.colModel){var col=p.colModel[i];var colNewSet={};colNewSet.columnName=col.name;colNewSet.showIndex=i;colNewSet.isFixedColumn=col.isFixedColumn;colNewSet.isShow=!col.isHide;arr.push(colNewSet);}customSettings=arr;}}catch(e){}return customSettings;},delDragSettings:function(){if(p.id==null){return;}window.localStorage.setItem("tableDragSet"+p.id+getUserId(),"");},setDragSettings:function(){if(p.id==null){return;}var tableSet="";tableSet="[";for(var n=0;n<30;n++){var th=$("#th"+n);if(!th){break;}tableSet+='{"name":"'+$(th).attr("name")+'","personwidth":"'+$(th).attr("personwidth")+'"},';}tableSet=tableSet.substring(0,tableSet.length-1);tableSet+="]";window.localStorage.setItem("tableDragSet"+p.id+getUserId(),tableSet);},getDragSettings:function(){if(p.id==null){return null;}var customSettings=null;try{customSettings=window.localStorage.getItem("tableDragSet"+p.id+getUserId());if(customSettings!=null&&customSettings!=""){customSettings=eval(customSettings);}}catch(e){}return customSettings;},addData:function(data){myRows=data.rows;sumRow=data.sumRow;var g=this;data=$.extend({rows:[],page:0,total:0},data);this.loading=false;addDataFlag=guidGenerator();data.addDataFlag=addDataFlag;p.total=data.total;if(p.total===0){$("tr, a,td, div",t).unbind();p.pages=1;p.page=1;this.emptyTables();var tr=createNoDataRow(t);this.buildpager();if(typeof loadedSuccess==="function"){loadedSuccess();}return false;}p.pages=Math.ceil(p.total/p.rp);p.page=data.page;this.buildpager();this.emptyTables();if($("#notusegridremember").val()=="1"){rememberCheckboxMap={};}if(!(data.rows instanceof Array)||data.rows.length<=0){var tr=createNoDataRow(t);if(typeof loadedSuccess==="function"){loadedSuccess();}}else{asynGenRow(data,0,p,g,t);}flexgridpage=p.page;flexgridrp=p.rp;},changeSort:function(th){$('input[type="checkbox"][name="fcheckbox"]:checked').each(function(){$(this).attr("checked",false);});$("#selectAllCheckbox").removeAttr("checked");rememberCheckboxMap={};if(p.draging){return;}var resetSort=false;if(String(p.sortname).toUpperCase()==String(th.abbr).toUpperCase()){if(p.sortorder=="desc"){p.sortorder="asc";}else{if(String(p.sortname).toUpperCase()==String(p.sortNameOrigin).toUpperCase()){p.sortorder="desc";}else{resetSort=true;}}}else{p.sortname=th.abbr;p.sortorder="desc";}if(resetSort){p.sortorder=p.sortOrderOrigin;p.sortname=p.sortNameOrigin;window.localStorage.removeItem("tableSet_sortorder"+p.id+getUserId());window.localStorage.removeItem("tableSet_sortname"+p.id+getUserId());}else{window.localStorage.setItem("tableSet_sortorder"+p.id+getUserId(),p.sortorder);window.localStorage.setItem("tableSet_sortname"+p.id+getUserId(),p.sortname);}var flexiGridRoot=$("#"+p.FlexiGridRootId);var ths=$("#theader th",flexiGridRoot);for(var n=0;n<ths.length;n++){if($(ths[n]).attr("sortable")=="true"){if(String($(ths[n]).attr("abbr")).toUpperCase()==String(p.sortname).toUpperCase()){if(String(p.sortorder).toLowerCase()=="desc"){$(ths[n]).attr("class","sortable down");$(ths[n]).attr("sort","desc");}else{$(ths[n]).attr("class","sortable up");$(ths[n]).attr("sort","asc");}}else{$(ths[n]).attr("class","normal sortable");$(ths[n]).attr("sort","");}}else{$(ths[n]).attr("class","normal");}}$("#currentsortorder").val(p.sortorder);$("#currentsortname").val(p.sortname);this.populate();},buildpager:function(){var r1=p.total==0?0:(p.page-1)*p.rp+1;var r2=r1+p.rp-1;if(p.total<r2){r2=p.total;}var stat=p.pagestat;stat=stat.replace(/{from}/,r1);stat=stat.replace(/{to}/,r2);stat=stat.replace(/{total}/,p.total);var flexiGridRoot=$("#"+p.FlexiGridRootId);$(flexiGridRoot).find("#page").val(p.page);$(flexiGridRoot).find("#pages").html(p.total);if(p.total==0){$(flexiGridRoot).find("#next").attr("class","nextUnclickable");$(flexiGridRoot).find("#last").attr("class","lastUnclickable");$(flexiGridRoot).find("#pre").attr("class","preUnclickable");$(flexiGridRoot).find("#first").attr("class","firstUnclickable");}else{if(p.page==1){$(flexiGridRoot).find("#pre").attr("class","preUnclickable");$(flexiGridRoot).find("#first").attr("class","firstUnclickable");}else{$(flexiGridRoot).find("#pre").attr("class","pre");$(flexiGridRoot).find("#first").attr("class","first");}var pageCount=0;if(p.total%p.rp>0){pageCount=p.total/p.rp+1;}else{pageCount=p.total/p.rp;}pageCount=Math.floor(pageCount);if(pageCount==p.page){$(flexiGridRoot).find("#next").attr("class","nextUnclickable");$(flexiGridRoot).find("#last").attr("class","lastUnclickable");}else{$(flexiGridRoot).find("#next").attr("class","next");$(flexiGridRoot).find("#last").attr("class","last");}}},populate:function(i,isRememberChecked){if(undefined!=isRememberChecked&&false==isRememberChecked){$('input[type="checkbox"][name="fcheckbox"]:checked').each(function(){$(this).attr("checked",false);});$("#selectAllCheckbox").removeAttr("checked");clearRememberCheckboxMap();}if(i!=undefined&&null!=i){p.newp=1;}$(".loadding").show();var g=this;if(!p.newp){p.newp=1;}if(p.page>p.pages){p.page=p.pages;}var param=[{name:"page",value:p.newp},{name:"rp",value:p.rp},{name:"sortname",value:p.sortname},{name:"sortorder",value:p.sortorder},{name:"query",value:p.query},{name:"qtype",value:p.qtype}];if(p.setPageParams){p.params=eval(p.setPageParams);}if(p.params.length){for(var pi=0;pi<p.params.length;pi++){param[param.length]=p.params[pi];}}if(p.url.indexOf("transNo")==-1){p.url=p.url.indexOf("?")>-1?(p.url+"&transNo="+guidGenerator()):(p.url+"?transNo="+guidGenerator());}$.ajax({type:p.method,url:p.url,data:param,dataType:p.dataType,success:function(data){if(data.timeOutTips=="222"){timeouttips=true;if(timeouttips==true){timeouttips=false;if(!confirm("当前页面数据加载超时，确定要重新加载数据？")){return;}else{setTimeout(function(){$(".loadding").show();$("#refresh").click();},800);}}}g.addData(data);$(".loadding").hide();},error:function(XMLHttpRequest,textStatus,errorThrown){$(".loadding").hide();}});},changePage:function(ctype){switch(ctype){case"first":p.newp=1;break;case"prev":if(p.page>1){p.newp=parseInt(p.page,10)-1;}break;case"next":if(p.page<p.pages){p.newp=parseInt(p.page,10)+1;}break;case"last":p.newp=p.pages;break;case"input":var nv=$("#page").val();if(isNaN(nv)){nv=1;}if(nv<1){nv=1;}else{if(nv>p.pages){nv=p.pages;}}$("#page").val(nv);p.newp=nv;break;}if(p.newp==p.page){return false;}this.populate();},addCellProp:function(){var g=this;$("tbody tr td",g.bDiv).each(function(){var tdDiv=document.createElement("div");if(p.nowrap==false){$(tdDiv).css("white-space","normal");}if(this.innerHTML==""){this.innerHTML="&nbsp;";}tdDiv.innerHTML=this.innerHTML;$(this).empty().append(tdDiv).removeAttr("width");});},mustResizeTableWidth:function(){try{var g=this;var pDivWidth=parseInt($(g.pDiv).css("width"));var preResizeWidth=parseInt($(g.pDiv).attr("preResizeWidth"));var widthChange=pDivWidth!=preResizeWidth;if(widthChange){return true;}if("auto"!=p.height){$(g.bDiv).height(p.height-50);$(g.left_bDiv).height(p.height-10);}else{var nowHeight=400;if(window.innerHeight){nowHeight=window.innerHeight;}else{nowHeight=document.documentElement.clientHeight;}$(g.bDiv).height(nowHeight-$(g.bDiv).offset().top-90);if(!p.colModel_Detail&&!p.noLeftSplit){$(g.left_bDiv).height(nowHeight-$(g.bDiv).offset().top-90-15);}}$(t).find(".listNoData_parent").height($(g.bDiv).height()-70);}catch(e){}return false;},resizeTableWidth:function(){try{var g=this;var pDivWidth=parseInt($(g.pDiv).css("width"));var left_hDivWidth=0;if(!p.colModel_Detail&&!p.noLeftSplit){left_hDivWidth=parseInt($(g.left_hDiv).css("width"));}$(g.bDiv).css("width",pDivWidth-3);$(g.hDiv).css("width",pDivWidth-3);var tableWidth=0;$("#theader th",g.hDiv).each(function(){if($(this).is(":visible")||$(this).css("display")==""){tableWidth+=parseInt($(this).attr("personwidth"))+11;}});$("tr",g.bDiv).each(function(n){if($(this).attr("NormalRow")||$(this).attr("SumRow")){$("td",this).each(function(i){var thid=$(this).attr("thid");if(thid){var th=$("#"+thid,g.hDiv);var width=th.attr("personwidth");width=parseInt(width);$(this).css("width",width+"px");$(this).find(".tableText").each(function(){$(this).css("width",width+"px");});}});}});$(t).attr("width",tableWidth+1);$(g.hTable).attr("width",tableWidth+1);if(!p.colModel_Detail&&!p.noLeftSplit){$("tr",g.left_bDiv).each(function(){$(this).height($("#"+$(this).attr("id"),g.bDiv).height());});}$(t).find(".listNoData_parent").width(pDivWidth-33);$(g.hTable).css("left",-1*$(g.bDiv).scrollLeft());$(g.pDiv).attr("preResizeWidth",pDivWidth);var hDivWidth=$(g.hDiv).width();var hTableWidth=$("table",g.hDiv).width();hTableWidth=hTableWidth-$("table",g.hDiv).find(":visible[name='FillEmptyColumn']").width();if(Number(hDivWidth)-Number(hTableWidth)>11){$("table",g.hDiv).attr("width",hDivWidth);if($(g.bDiv).height()<$("table",g.bDiv).height()){$("table",g.bDiv).attr("width",Number(hDivWidth)-getScrollWidth());}else{$("table",g.bDiv).attr("width",hDivWidth);}g.showOrHideColum("FillEmptyColumn",true,true);var width=Number(hDivWidth)-Number(hTableWidth);$("th[name='FillEmptyColumn']",g.Div).css("width","").removeAttr("width").empty().attr("personwidth",Number(width)-12);$("td[thname='FillEmptyColumn']",g.bDiv).css("width","").removeAttr("width").empty().attr("personwidth",Number(width)-12);}else{g.showOrHideColum("FillEmptyColumn",false,true);}}catch(e){}},emptyTables:function(){var g=this;$(g.bDiv).find("tr").each(function(){var id=$(this).attr("id");if(id!="theader"){$(this).remove();}});$(g.left_bTable).find("tr").each(function(){var id=$(this).attr("id");if(id!="theader"){$(this).remove();}});},pager:0};myGrid=g;g=p.getGridClass(g);g.gDiv=document.createElement("div");g.gDiv.id=p.FlexiGridRootId;g.gDiv.className="flexigrid";$(g.gDiv).css("overflow","hidden");$(t).before(g.gDiv);g.tAllDiv=document.createElement("div");$(g.tAllDiv).attr("style","width:100%;overflow:hidden; display: flex; position:relative; border: solid 1px #d7d7d7; box-sizing: border-box;");$(g.gDiv).append(g.tAllDiv);g.tLeftDiv=document.createElement("div");g.tLeftDiv.className="t_left";$(g.tLeftDiv).css("position","absolute");$(g.tLeftDiv).css("z-index","999");g.tRightDiv=document.createElement("div");g.tRightDiv.className="t_r";$(g.tAllDiv).append(g.tLeftDiv);$(g.tAllDiv).append(g.tRightDiv);g.hDiv=document.createElement("div");g.hDiv.className="hDiv";$(g.tRightDiv).append(g.hDiv);$(g.hDiv).css("background-color","#fff");$(g.hDiv).css("position","relative");g.hTable=document.createElement("table");g.hTable.cellPadding=p.trCellPadding;g.hTable.cellSpacing=0;$(g.hTable).attr("class","tableStyle borderLTNone");$(g.hTable).css("position","relative");if(!p.colModel_Detail&&!p.noLeftSplit){$(g.hTable).css("border-left","0px");}var tr=document.createElement("tr");$(tr).attr("id","theader");var trLeft=document.createElement("tr");$(trLeft).attr("id","theader");var customSettings=g.getCustomSettings();var dragSettings=g.getDragSettings();var tableWidth=0;var leftTableWidth=0;for(var i=0;i<p.colModel.length;i++){var cm=p.colModel[i];var th=document.createElement("th");if(cm.display=="操作"){cm.name="Action";}if(p.colResize&&dragSettings!=null&&dragSettings.length>0){if(dragSettings[i].name==cm.name){cm.width=dragSettings[i].personwidth;}}if(cm.isHide){$(th).hide();}if(cm.isConfigurable&&customSettings!=null&&customSettings.length>0){for(var n=0;n<customSettings.length;n++){if(customSettings[n].name==cm.name){if(customSettings[n].checked=="checked"){$(th).show();}else{$(th).hide();}}}}$(th).attr("id","th"+i);$(th).attr("number",""+i);var personwidth=0;if(cm.width){personwidth=cm.width;}else{personwidth=150;}if(!(p.colResize&&dragSettings!=null&&dragSettings.length>0)){if(cm.isButton&&p.buttons&&p.buttons.length>0){if(p.buttons.length==1){personwidth=80;}else{if(p.buttons.length==2){personwidth=100;}else{if(p.buttons.length==3){personwidth=150;}else{if(p.buttons.length==4){personwidth=190;}}}}}if(cm.display&&cm.display.length>=2&&personwidth<40){personwidth=40;}}$(th).attr("personwidth",personwidth);$(th).attr("width",personwidth);$(th).attr("info",false);if(isMoneyColum(cm.display)&&cm.display.indexOf("元")==-1){cm.display+="(元)";}$(th).attr("display",cm.display);$(th).attr("name",cm.name);th.innerHTML='<span class="bg" style="width:'+personwidth+'px">'+cm.display+"</span>";if(cm.isRemark){$(th).attr("info",true);$(th).attr("display",cm.display);th.innerHTML='<span class="bg" style="width:'+personwidth+'px">'+cm.display+'</span><span class="info" onmouseover="$(this).children().show()" onmouseout="$(this).children().hide()"><span class="tips" style="top:25px;display:none"><h2></h2><h1>'+cm.remarkContent+"</h1></span></span>";}if(cm.isNo&&p.isEnableShowOrHide){th.innerHTML='<a id="set" class="set"></a>';var setElement=$(th).find("#set");setElement.click(function(){var popSetHtml=templateHtml;topOrigin.layer.open({id:"popFlexigridColumnSetWrapper",title:false,area:"695px",closeBtn:0,btn:false,anim:-1,isOutAnim:false,content:popSetHtml,success:function(layero,index){topOrigin.$("#popFlexigridColumnSetWrapper").css({"overflow-x":"initial","overflow-y":"initial",padding:"0"});if("3"==topOrigin.$("#productversion").val()){topOrigin.$("#popFlexigridColumnSetWrapper").find(".freeNotShow").show();topOrigin.$("#popFlexigridColumnSetWrapper").find(".notFreeShow").hide();}else{topOrigin.$("#popFlexigridColumnSetWrapper").find(".freeNotShow").hide();topOrigin.$("#popFlexigridColumnSetWrapper").find(".notFreeShow").show();}topOrigin.$(".popFlexigridColumnSetCloseButton").click(function(){topOrigin.layer.close(index);});var addChooseColumn=function(col,modelIndex){var clone=topOrigin.$("#popFlexigridColumnSet_chooseDemo").clone();clone.removeAttr("id");clone.attr("modelIndex",modelIndex);clone.addClass("popFlexigridColumnSetColumn_chooseEach");clone.show();clone.find("#popFlexigridColumnSetColumnname").text(col.display);if(col.isFixedColumn){clone.addClass("attachDisableClick");}if(!col.columnSortable||"3"==topOrigin.$("#productversion").val()){clone.addClass("sortorder-disabled");}if(col.columnSortable&&"3"!=topOrigin.$("#productversion").val()){var mousedown=function(){$(this).bind("mousemove",mousemove);$(this).bind("mouseup",mouseup);};var mousemove=function(){$(this).addClass("attachDrag");};var mouseup=function(){$(this).unbind("mousemove",mousemove);$(this).unbind("mousedown",mousedown);$(this).removeClass("attachDrag");};clone.bind("mousedown",mousedown);}if(col.canSetShow){clone.bind("mouseover",function(){$(this).find("#popFlexigridColumnSetClose").show();});clone.bind("mouseout",function(){$(this).find("#popFlexigridColumnSetClose").hide();});}if(col.canSetShow){clone.click(function(){removeChooseColumn(col,$(this).attr("modelIndex"));$(this).remove();});}topOrigin.$("#popFlexigridColumnSet_chooseColumn").append(clone);return clone;};var removeChooseColumn=function(col,modelIndex){var clone=topOrigin.$("#popFlexigridColumnSet_notChooseDemo").clone();clone.removeAttr("id");clone.attr("modelIndex",modelIndex);clone.addClass("popFlexigridColumnSetColumn_notChooseEach");clone.show();clone.text(col.display);if(col.canSetShow){clone.click(function(){addChooseColumn(col,$(this).attr("modelIndex"));$(this).remove();});}topOrigin.$("#popFlexigridColumnSet_notChooseColumn").append(clone);};var customSettings=g.getCustomSettings();var colModelCopy=p.colModel;if(null!=customSettings&&""!=customSettings&&customSettings.length>0){colModelCopy=JSON.parse(JSON.stringify(p.colModel));var getSetCol=function(columnName){for(var each in customSettings){if(columnName==customSettings[each].columnName){return customSettings[each];}}};for(var each in colModelCopy){var setCol=getSetCol(colModelCopy[each].name);if("undefined"!=typeof setCol&&setCol.isShow){colModelCopy[each].isHide=false;}else{colModelCopy[each].isHide=true;}}colModelCopy.sort(function(a,b){var setColA=getSetCol(a.name);var indexA=null;var setColB=getSetCol(b.name);var indexB=null;if("undefined"==typeof setColA||"undefined"==typeof setColA.showIndex){indexA=9999;}else{indexA=setColA.showIndex;}if("undefined"==typeof setColB||"undefined"==typeof setColB.showIndex){indexB=9999;}else{indexB=setColB.showIndex;}if(a.isCheckbox){indexA=-9999;}if(b.isCheckbox){indexB=-9999;}if(a.isNo){indexA=-9998;}if(b.isNo){indexB=-9998;}if(a.isButton){indexA=-9997;}if(b.isButton){indexB=-9997;}if(Number(indexA)>Number(indexB)){return 1;}else{return -1;}});}console.log(colModelCopy);for(var i=0;i<colModelCopy.length;i++){var col=colModelCopy[i];if(!col.isConfigurable){continue;}if(col.isHide){removeChooseColumn(col,i);}else{addChooseColumn(col,i);}}topOrigin.$("#popFlexigridColumnSet_chooseColumn").sortable({items:"li:not(.sortorder-disabled)",stop:function(event,ui){}});topOrigin.$("#popFlexigridColumnSet_done").click(function(){var tableSet=[];topOrigin.$(".popFlexigridColumnSetColumn_chooseEach, .popFlexigridColumnSetColumn_notChooseEach").each(function(eachIndex){var modelIndex=$(this).attr("modelIndex");var col=colModelCopy[modelIndex];var colNewSet={};colNewSet.columnName=col.name;colNewSet.showIndex=eachIndex;colNewSet.isFixedColumn=col.isFixedColumn;if($(this).hasClass("popFlexigridColumnSetColumn_chooseEach")){colNewSet.isShow=true;}else{colNewSet.isShow=false;}tableSet.push(colNewSet);});window.localStorage.setItem("tableColumnSet_"+p.id+"_"+getUserId(),JSON.stringify(tableSet));g.columnSort();topOrigin.layer.close(index);});topOrigin.$(".popFlexigridColumnReSetButton").click(function(){window.localStorage.removeItem("tableColumnSet_"+p.id+"_"+getUserId());g.columnSort();topOrigin.layer.close(index);setElement.click();});topOrigin.$(top).resize();}});});}$(th).attr("sortable",false);$(th).attr("abbr",cm.name);if(cm.sortable==true&&!(cm.isNo||cm.isCheckbox||cm.isNotSorted)){$(th).attr("sortable",true);if(cm.sortName){$(th).attr("abbr",cm.sortName);}}if($(th).attr("sortable")=="true"){$(th).bind("mousedown",function(){if(window.location.href.indexOf("Product/PopList.htm")>=0){$("#autofilterlist").attr("checked",false);setCookie("memoryautofilterlist_"+request("SaleOrderBusi")+"_"+$("#popContactid").val(),"0");$("#hidisautofilter").val(0);}g.changeSort(this);});if((cm.name+"").toLowerCase()==(p.sortname+"").toLowerCase()){if(p.sortorder=="desc"){$(th).attr("class","sortable down");$(th).attr("sort","desc");}else{$(th).attr("class","sortable up");$(th).attr("sort","asc");}}else{$(th).attr("class","normal sortable");$(th).attr("sort","");}}else{$(th).attr("class","normal");}th.align="center";if(cm.align&&cm.align=="left"){th.align="left";}$(th).attr("checkbox",false);if(cm.isCheckbox){$(th).attr("checkbox",cm.isCheckbox);th.innerHTML='<input id="selectAllCheckbox" type="checkbox"  onclick="selectAllCheckBox(this,\''+p.FlexiGridRootId+"');\"/>";}$(th).attr("button",false);if(cm.isButton){$(th).attr("button",true);}if(cm.noDrag){}else{var dragLineLeft=parseInt($(th).attr("personwidth"))+9;var dragLineDiv=document.createElement("div");$(th).append(dragLineDiv);$(dragLineDiv).attr("id","dragLineDiv"+i);$(dragLineDiv).attr("index",i);$(dragLineDiv).addClass("dragLine");$(dragLineDiv).css({left:dragLineLeft+"px",top:"0px"});$(dragLineDiv).mousedown(function(e){g.dragStart("colresize",e,this);});}var isShow=$(th).is(":visible")||$(th).css("display")=="";if(cm.isLeft){if(isShow){leftTableWidth+=parseInt($(th).attr("personwidth"));}$(trLeft).append(th);var clone=$(th).clone(true);$(tr).append(clone);}else{if(isShow){tableWidth+=parseInt($(th).attr("personwidth"));}$(tr).append(th);}}$(t).attr("width",tableWidth);$(g.hTable).attr("width",tableWidth);$(g.hTable).append(tr);$(g.hDiv).append(g.hTable);if(!p.colModel_Detail&&!p.noLeftSplit){g.left_hDiv=document.createElement("div");g.left_hDiv.className="hDivLeft";$(g.left_hDiv).css("background-color","#fff");$(g.left_hDiv).css("position","relative");$(g.left_hDiv).css("z-index","101");g.left_hTable=document.createElement("table");g.left_hTable.cellPadding=p.trCellPadding;g.left_hTable.cellSpacing=0;$(g.left_hTable).attr("class","tableStyle borderLTNone");$(g.left_hTable).css("position","relative");$(g.left_hTable).append(trLeft);$(g.left_hDiv).append(g.left_hTable);$(g.tLeftDiv).append(g.left_hDiv);g.left_bDiv=document.createElement("div");$(g.left_bDiv).attr("style","background-color:#fff;overflow:hidden;position:relative;");g.left_bDiv.className="bDivLeft";g.left_bTable=document.createElement("table");g.left_bTable.cellPadding=p.trCellPadding;g.left_bTable.cellSpacing=0;$(g.left_bTable).attr("class","tableStyle borderLTNone");$(g.left_bTable).css("border-top","0px");$(g.left_bTable).css("position","relative");$(g.left_bDiv).append(g.left_bTable);$(g.tLeftDiv).append(g.left_bDiv);}g.bDiv=document.createElement("div");$(g.tRightDiv).append(g.bDiv);$(g.bDiv).attr("style","background-color:#fff;overflow-x:auto;");g.bDiv.className="bDiv";$(g.bDiv).append(t);t.cellPadding=p.trCellPadding;t.cellSpacing=0;$(t).attr("class","tableStyle borderLTNone");$(t).css("border-top","0px");if(!p.colModel_Detail&&!p.noLeftSplit){$(t).css("border-left","0px");}g.addCellProp();$(g.bDiv).scroll(function(){$(g.hTable).css("left",-1*$(g.bDiv).scrollLeft());$(g.left_bTable).css("top",-1*$(g.bDiv).scrollTop());});g.pDiv=document.createElement("div");g.pDiv.className="pDiv";$(g.gDiv).append(g.pDiv);g.pTable=document.createElement("table");g.pTable.cellPadding=0;g.pTable.cellSpacing=0;$(g.pDiv).append(g.pTable);$(g.pTable).attr("width","100%");$(g.pTable).attr("border","0");var tdString="";var trString="<tr>";var a=0;var customSettings=g.getCustomSettings();selectString=selectString+"</select>";var settingsButton="";var selectString='<select id="changepagesize" name="" style="height:25px" class="fl mr5">';for(var i=0;i<p.rpOptions.length;i++){var selected="";if(p.rpOptions[i]==p.rp){selected="selected";}selectString=selectString+'<option value="'+p.rpOptions[i]+'" '+selected+">"+p.rpOptions[i]+"</option>";}selectString=selectString+"<select/>";var trString='<tr><td><div style="margin: 0 auto; width: 470px;"><div class="pageTop"><span>每页显示</span>'+selectString+'<span>条数据</span><a id="first" class="first"></a><a id="pre" class="pre"></a><span>当前在</span><input id="page" name="" style="height:19px" type="text" class="pageInput fl"  size="3" ><span>页</span><a id="next" class="next"></a><a id="last" class="last"></a><span>共<b id="pages"></b>条数据</span></div></div></td><td align="right">'+settingsButton+'<a id="refresh" class="refresh" style="display: none;"></a></td><input type="hidden" id="currentsortname" value="'+p.sortname+'"><input type="hidden" id="currentsortorder" value="'+p.sortorder+'"></tr>';$(g.pTable).append(trString);$(g.pDiv).append('<div style="height:10px"></div>');$(g.gDiv).find("#first,#last,#next").click(function(){if(window.location.href.indexOf("OutStorage/List")>0){rememberCheckboxMap={};}g.changePage(this.id);});$(g.gDiv).find("#pre").click(function(){if(window.location.href.indexOf("OutStorage/List")>0){rememberCheckboxMap={};}g.changePage("prev");});$(g.gDiv).find("#page").keydown(function(){var event=arguments.callee.caller.arguments[0]||window.event;if(event.keyCode==13){g.changePage("input");}});$(g.gDiv).find("#refresh").click(function(){$("#SearchKeyWord").val("");$("#keyword").val("");g.populate();document.onselectstart=function(){return false;};});$(g.gDiv).find("#changepagesize").change(function(){p.newp=1;p.page=1;p.rp=$(this).val();g.populate();flexgridpage=1;flexgridrp=$(this).val();window.localStorage.setItem("tableSet_rp"+p.id+getUserId(),p.rp);});t.p=p;t.grid=g;if(p.url){g.populate();}$(document).mousemove(function(e){g.dragMove(e);}).mouseup(function(e){g.dragEnd();}).hover(function(){},function(){g.dragEnd();});return t;};var docloaded=false;$(document).ready(function(){docloaded=true;});$.fn.flexigrid=function(p){return this.each(function(){if(!docloaded){$(this).hide();var t=this;$(document).ready(function(){$.addFlex(t,p);});}else{$.addFlex(this,p);}});};$.fn.flexReload=function(p,isSearch,isRememberChecked){if(isRememberChecked){isRememberChecked=true;}if(isSearch){return this.each(function(){if(this.grid&&this.p.url){this.grid.populate(1,isRememberChecked);}});}return this.each(function(){if(this.grid&&this.p.url){this.grid.populate(null,isRememberChecked);}});};$.fn.noSelect=function(p){if(p){$(".flexigrid").attr("unselectable","on");$(".flexigrid").css("-webkit-user-select","none");$(".flexigrid").css("-moz-user-select","none");}else{$(".flexigrid").removeAttr("unselectable","on");$(".flexigrid").css("-webkit-user-select","");$(".flexigrid").css("-moz-user-select","");}};})(jQuery);function selectAllCheckBox(h,b){var g=window.location.href;if(g.indexOf("nowarehouselock=nolocked")==-1){var e=$(parent.document).find("#productversion").val();if(e!=3){var c=$("#hiddetailwarehouseid").val();if(c!=undefined&&c!=""&&c!=null){if(getWareHouseIsLocked(2)){return;}}}}var a=$("#"+b);var f=null;flexgridpage=parseInt(flexgridpage);flexgridrp=parseInt(flexgridrp);for(var d=(flexgridpage-1)*flexgridrp+1;d<=((flexgridpage-1)*flexgridrp+flexgridrp);d++){if(b){f=$("#fcheckbox"+d,a).val();}else{f=$("#fcheckbox"+d).val();}if($("#notusegridremember").val()!="1"){if(h.checked){rememberCheckboxMap[d]=f;}else{delete rememberCheckboxMap[d];}}}if(b){if(h.checked){$("input[listcheck='0']",a).attr("checked","true");$("#selectall",a).attr("checked","true");$("tr[normalrow='true']",a).addClass("yellowLine");}else{$("input[listcheck='0']",a).removeAttr("checked");$("#selectall",a).removeAttr("checked");$("tr[normalrow='true']",a).removeClass("yellowLine");}}else{if(h.checked){$("input[listcheck='0']").attr("checked","true");$("#selectall").attr("checked","true");$("tr[normalrow='true']").addClass("yellowLine");}else{$("input[listcheck='0']").removeAttr("checked");$("#selectall").removeAttr("checked");$("tr[normalrow='true']").removeClass("yellowLine");}}}function clearRememberCheckboxMap(){rememberCheckboxMap=[];}function getData(a){return myRows[a];}function getSelectIds(){var a="";$.each(rememberCheckboxMap,function(b,c){if(c!=""&&c!=undefined){a+=c+",";}});if(a!=""){a=a.substring(0,a.length-1);}rememberCheckboxMap={};return a;}function getSelectNumber(){var c=new Array();var b=$("input[listcheck='0']");for(var a=0;a<b.length;a++){if(b[a].checked){c.push(a);}}return c;}function getSelectIdsNoCel(){var a="";$.each(rememberCheckboxMap,function(b,c){if(c!=""&&c!=undefined){a+=c+",";}});if(a!=""){a=a.substring(0,a.length-1);}return a;}function getScrollWidth(){var c,a,b=document.createElement("DIV");b.style.cssText="position:absolute; top:-1000px; width:100px; height:100px; overflow:hidden;";c=document.body.appendChild(b).clientWidth;b.style.overflowY="scroll";a=b.clientWidth;document.body.removeChild(b);return c-a;}var templateHtml='<div class="popArea cm" style="width: 695px; position: initial;"><div class="title"><div class="text">列配置</div><div class="close"><a href="javascript:;" class="closeButton popFlexigridColumnSetCloseButton"></a></div></div><!-- title --><div class="content cm"><div class="row rowReset font333"><span class="font14 mr5 ml10">已显示字段</span><span class="font12 font999 notFreeShow" style="display: none;"> 拖动可调整字段顺序 </span><span class="freeNotShow" style="display: none;"><span class="font12 font999">专业版/连锁版可支持调整列表字段展示顺序，</span><a href="javascript:;" onclick="topOrigin.showChooseVersion()">立即升级</a></span></div><!--attachDisableClick: attachDrag:--><li class="" id="popFlexigridColumnSet_chooseDemo" style="display: none;"><span id="popFlexigridColumnSetColumnname">商品名称</span><a href="javascript:;" class="delLite" id="popFlexigridColumnSetClose" style="display: none;"></a></li><ul class="attachRow" id="popFlexigridColumnSet_chooseColumn"></ul><div class="row rowReset font333 pt20"><span class="font14 ml10">可选字段</span></div><li id="popFlexigridColumnSet_notChooseDemo" style="display: none;">属性</li><ul class="attachRow attachWait" id="popFlexigridColumnSet_notChooseColumn"></ul></div><!-- content --><div class="bottomButton cm_bt"><a href="javascript:;" class="button ml5 fl popFlexigridColumnReSetButton">恢复默认</a><a href="javascript:;" class="button blueButton mr10" id="popFlexigridColumnSet_done">确认</a><a href="javascript:;" class="button mr10 popFlexigridColumnSetCloseButton">取消</a></div><!-- bottomButton --></div>';